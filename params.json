{
  "name": "Saltstack-infratest-module",
  "tagline": "A Salt module using the testinfra python module for infrastructure compliance testing and auditing.",
  "body": "# saltstack-infratest-module\r\nA Salt module using the testinfra python module for compliance testing and auditing. This allows you to take advantage of the many features of Salt, like the yaml merging for configuration and the database of servers to test.\r\n\r\n## Testinfra\r\nTestinfra is a python module created to test your infrastructure. For more info:\r\n - http://testinfra.readthedocs.org/en/latest/\r\n - https://github.com/philpep/testinfra\r\n\r\nThis module must be installed on each system you wish to test.  To install:\r\n```\r\n# pip install testinfra\r\n```\r\n\r\n## Install\r\nThere is a simple Salt formula available at https://github.com/ssplatt/infratest-formula.\r\n\r\nTo manually install the module, place `infratest.py` in the salt modules directory. By default this is `/srv/salt/_modules`. Then, run `salt \\* saltutil.sync_modules` to copy the module to all nodes.\r\n\r\n## Configure\r\nThis module loads configuration data from pillar so you can maintain it as you would any other server definition. For simple usage, create a `pillar/infratest` directory and place the `default.sls` inside it.  Then, in your `pillar/top.sls` file, configure a section to use `infratest.default`.  You can create other sls configuration files so you can overwrite and merge configurations for other servers. For example:\r\n\r\n```yaml\r\n# pillar/top.sls\r\n---\r\nbase:\r\n  '*':\r\n    - infratest.default\r\n  \r\n  'web*':\r\n    - infratest.web\r\n```\r\n\r\n```yaml\r\n# pillar/infratest/default.sls\r\n---\r\ninfratest:\r\n  file:\r\n    '/etc/passwd':\r\n      exists: true\r\n```\r\n\r\n```yaml\r\n# pillar/infratest/web.sls\r\n---\r\ninfratest:\r\n  file:\r\n    '/etc/httpd':\r\n      exists: true\r\n```\r\n\r\nThe yaml should merge so that all servers will check for `/etc/passwd` to exist and servers beginning with `web` will also check for `/etc/httpd` to exist. To confirm that your pillar data is merging the way you expect it, run `salt \\* pillar.get infratest` on your salt-master. `salt \\* saltutil.refresh_pillar` may be needed to refresh the pillar on all devices after changes have been made.\r\n\r\n## Usage\r\n### All Tests\r\n`# salt \\* infratest.run_all`\r\n\r\n```\r\nsalt-master.mycorp.com:\r\n    ----------\r\n    Failed:\r\n        - sshd is enabled: True\r\n    Passed:\r\n        - /etc/passwd exists: True\r\n        - /etc/passwd is: file\r\n        - /etc/passwd is owned by user: root\r\n        - /etc/passwd is owned by group: root\r\n        - /etc/passwd has mode: 0644\r\n        - /etc/passwd contains: root\r\n    Totals:\r\n        ----------\r\n        Fail:\r\n            1\r\n        Pass:\r\n            6\r\n```\r\n\r\n### All Tests with abreviated output\r\n`# salt \\* infratest.run_all details=False`\r\n\r\n```\r\nsalt-master.mycorp.com:\r\n    ----------\r\n    Fail:\r\n        1\r\n    Pass:\r\n        6\r\n```\r\n\r\n### A Single Test\r\n`# salt \\* infratest.test_file_mode /etc/passwd 0644`\r\n\r\n```\r\nsalt-master.mycorp.com:\r\n    ----------\r\n    Failed:\r\n    Passed:\r\n        - /etc/passwd has mode: 0644\r\n```\r\n\r\n## TODO\r\n 1. Process tests\r\n 2. LocalCommand tests\r\n 3. Socket clients tests\r\n 4. Socket get_listening_sockets tests\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}